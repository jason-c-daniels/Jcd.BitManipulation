#region

using System;
using System.Linq;

using Xunit;

// ReSharper disable RedundantExplicitArrayCreation
// ReSharper disable HeapView.ObjectAllocation.Evident
// ReSharper disable HeapView.ObjectAllocation
#pragma warning disable S107

#endregion

namespace Jcd.BitManipulation.Tests;

public class ByteArrayExtensionsTests
{
   [Fact]
   public void ToAnyInt_On_Empty_Array_Returns_Zero()
   {
      var empty = Array.Empty<byte>();
      Assert.Equal((byte) 0,   empty.ToByte());
      Assert.Equal((sbyte) 0,  empty.ToSByte());
      Assert.Equal((short) 0,  empty.ToInt16());
      Assert.Equal((ushort) 0, empty.ToUInt16());
      Assert.Equal(0,          empty.ToInt32());
      Assert.Equal((uint) 0,   empty.ToUInt32());
      Assert.Equal(0,          empty.ToInt64());
      Assert.Equal((ulong) 0,  empty.ToUInt64());
   }

   [Theory]
   [InlineData(0x01, 0x01)]
   [InlineData(0x02, 0x02)]
   [InlineData(0x03, 0x03)]
   public void ToByte_Returns_Expected_Value(byte d0, byte expected)
   {
      Assert.Equal(expected, new[] { d0 }.ToByte());
   }

   [Theory]
   [InlineData(0x01, 0x01)]
   [InlineData(0x02, 0x02)]
   [InlineData(0x73, 0x73)]
   public void ToSByte_Returns_Expected_Value(byte d0, sbyte expected)
   {
      Assert.Equal(expected, new[] { d0 }.ToSByte());
      Assert.Equal(expected, new[] { d0 }.ToSByte(Endian.Big));
   }

   [Theory]
   [InlineData(0x01, 0x02, 2, Endian.Little, 0x0201)]
   [InlineData(0x02, 0x01, 2, Endian.Big,    0x0201)]
   [InlineData(0x01, 0x02, 1, Endian.Little, 0x01)]
   [InlineData(0x02, 0x01, 1, Endian.Big,    0x0200)]
   public void ToUInt16_Returns_Expected_Value(byte d0, byte d1, int size, Endian endian, ushort expected)
   {
      Assert.Equal(expected, new[] { d0, d1 }.Take(size).ToArray().ToUInt16(endian));
   }

   [Theory]
   [InlineData(0x01, 0x02, 2, Endian.Little, 0x0201)]
   [InlineData(0x02, 0x01, 2, Endian.Big,    0x0201)]
   [InlineData(0x01, 0x02, 1, Endian.Little, 0x01)]
   [InlineData(0x02, 0x01, 1, Endian.Big,    0x0200)]
   public void ToInt16_Returns_Expected_Value(byte d0, byte d1, int size, Endian endian, short expected)
   {
      Assert.Equal(expected, new[] { d0, d1 }.Take(size).ToArray().ToInt16(endian));
   }

   [Theory]
   [InlineData(0x01, 0x02, 0x03, 0x04, 4, Endian.Little, ByteAlignment.InferredFromEndian,   0x04030201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 4, Endian.Big,    ByteAlignment.InferredFromEndian,   0x04030201)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 3, Endian.Little, ByteAlignment.InferredFromEndian,   0x030201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 3, Endian.Big,    ByteAlignment.InferredFromEndian,   0x04030200)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 2, Endian.Little, ByteAlignment.InferredFromEndian,   0x0201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 2, Endian.Big,    ByteAlignment.InferredFromEndian,   0x04030000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 1, Endian.Little, ByteAlignment.InferredFromEndian,   0x01)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 1, Endian.Big,    ByteAlignment.InferredFromEndian,   0x04000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 4, Endian.Little, ByteAlignment.MostSignificantByte,  0x04030201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 4, Endian.Big,    ByteAlignment.LeastSignificantByte, 0x04030201)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 3, Endian.Little, ByteAlignment.MostSignificantByte,  0x03020100)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 3, Endian.Big,    ByteAlignment.LeastSignificantByte, 0x00040302)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 2, Endian.Little, ByteAlignment.MostSignificantByte,  0x02010000)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 2, Endian.Big,    ByteAlignment.LeastSignificantByte, 0x00000403)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 1, Endian.Little, ByteAlignment.MostSignificantByte,  0x01000000)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 1, Endian.Big,    ByteAlignment.LeastSignificantByte, 0x00000004)]
   public void ToUInt32_Returns_Expected_Value(byte d0, byte d1, byte d2, byte d3, int size, Endian endian, ByteAlignment align, uint expected)
   {
      Assert.Equal(expected, new[] { d0, d1, d2, d3 }.Take(size).ToArray().ToUInt32(endian, align));
   }

   [Theory]
   [InlineData(0x01, 0x02, 0x03, 0x04, 4, Endian.Little, 0x04030201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 4, Endian.Big,    0x04030201)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 3, Endian.Little, 0x030201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 3, Endian.Big,    0x04030200)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 2, Endian.Little, 0x0201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 2, Endian.Big,    0x04030000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 1, Endian.Little, 0x01)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 1, Endian.Big,    0x04000000)]
   public void ToInt32_Returns_Expected_Value(byte d0, byte d1, byte d2, byte d3, int size, Endian endian, int expected)
   {
      Assert.Equal(expected, new[] { d0, d1, d2, d3 }.Take(size).ToArray().ToInt32(endian));
   }

   [Theory]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 8, Endian.Little, 0x0807060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 8, Endian.Big,    0x0807060504030201)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 7, Endian.Little, 0x07060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 7, Endian.Big,    0x0807060504030200)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 6, Endian.Little, 0x060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 6, Endian.Big,    0x0807060504030000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 5, Endian.Little, 0x0504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 5, Endian.Big,    0x0807060504000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 4, Endian.Little, 0x04030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 4, Endian.Big,    0x0807060500000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 3, Endian.Little, 0x030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 3, Endian.Big,    0x0807060000000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 2, Endian.Little, 0x0201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 2, Endian.Big,    0x0807000000000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 1, Endian.Little, 0x01)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 1, Endian.Big,    0x0800000000000000)]
   public void ToUInt64_Returns_Expected_Value(byte d0, byte d1, byte d2, byte d3, byte d4, byte d5, byte d6, byte d7, int size, Endian endian, ulong expected)
   {
      var actual = new[] { d0, d1, d2, d3, d4, d5, d6, d7 }.Take(size).ToArray().ToUInt64(endian);
      Assert.Equal(expected, actual);
   }

   [Theory]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 8, Endian.Little, 0x0807060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 8, Endian.Big,    0x0807060504030201)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 7, Endian.Little, 0x07060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 7, Endian.Big,    0x0807060504030200)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 6, Endian.Little, 0x060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 6, Endian.Big,    0x0807060504030000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 5, Endian.Little, 0x0504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 5, Endian.Big,    0x0807060504000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 4, Endian.Little, 0x04030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 4, Endian.Big,    0x0807060500000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 3, Endian.Little, 0x030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 3, Endian.Big,    0x0807060000000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 2, Endian.Little, 0x0201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 2, Endian.Big,    0x0807000000000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 1, Endian.Little, 0x01)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 1, Endian.Big,    0x0800000000000000)]
   public void ToInt64_Returns_Expected_Value(byte d0, byte d1, byte d2, byte d3, byte d4, byte d5, byte d6, byte d7, int size, Endian endian, long expected)
   {
      Assert.Equal(expected, new[] { d0, d1, d2, d3, d4, d5, d6, d7 }.Take(size).ToArray().ToInt64(endian));
   }

   [Theory]
   [InlineData(0x01, 0x02, 0x03, 0x04, 4, Endian.Little, 0x04030201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 4, Endian.Big,    0x04030201)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 3, Endian.Little, 0x030201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 3, Endian.Big,    0x04030200)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 2, Endian.Little, 0x0201)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 2, Endian.Big,    0x04030000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 1, Endian.Little, 0x01)]
   [InlineData(0x04, 0x03, 0x02, 0x01, 1, Endian.Big,    0x04000000)]
   public void Single_Returns_Expected_Value(byte d0, byte d1, byte d2, byte d3, int size, Endian endian, int expected)
   {
      Assert.Equal(expected.BitwiseToSingle(), new byte[] { d0, d1, d2, d3 }.Take(size).ToArray().ToSingle(endian));
   }

   [Theory]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 8, Endian.Little, 0x0807060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 8, Endian.Big,    0x0807060504030201)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 7, Endian.Little, 0x07060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 7, Endian.Big,    0x0807060504030200)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 6, Endian.Little, 0x060504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 6, Endian.Big,    0x0807060504030000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 5, Endian.Little, 0x0504030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 5, Endian.Big,    0x0807060504000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 4, Endian.Little, 0x04030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 4, Endian.Big,    0x0807060500000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 3, Endian.Little, 0x030201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 3, Endian.Big,    0x0807060000000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 2, Endian.Little, 0x0201)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 2, Endian.Big,    0x0807000000000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 1, Endian.Little, 0x01)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 1, Endian.Big,    0x0800000000000000)]
   [InlineData(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0, Endian.Little, 0x00)]
   [InlineData(0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 0, Endian.Big,    0x00)]
   public void ToDouble_Returns_Expected_Value(byte d0, byte d1, byte d2, byte d3, byte d4, byte d5, byte d6, byte d7, int size, Endian endian, ulong expected)
   {
      Assert.Equal(expected.BitwiseToDouble(), new[] { d0, d1, d2, d3, d4, d5, d6, d7 }.Take(size).ToArray().ToDouble(endian));
   }
}